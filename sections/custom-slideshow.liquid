{% comment %}
Custom Advanced Slideshow Section
Includes:
- Slide-specific animation
- Multiple buttons per slide
- Background video support
- Custom fonts
- Per-slide duration
- Overlay color + opacity
- Keyboard navigation
{% endcomment %}

{{ 'component-slider.css' | asset_url | stylesheet_tag }}

<section class="custom-slideshow" tabindex="0" aria-keyshortcuts="ArrowLeft ArrowRight">
  <div class="custom-slider" id="CustomSlider-{{ section.id }}">
    {% for block in section.blocks %}
      {% assign slide_id = 'slide-' | append: section.id | append: '-' | append: forloop.index %}
      <div 
        class="custom-slide animate--{{ block.settings.slide_animation }}"
        id="{{ slide_id }}"
        data-duration="{{ block.settings.slide_duration | default: 5 }}">

        {% if block.settings.video_url != blank %}
          <video autoplay loop muted playsinline class="slide-media">
            <source src="{{ block.settings.video_url }}" type="video/mp4">
          </video>
        {% elsif block.settings.image %}
          <div class="slide-media" style="background-image: url({{ block.settings.image | image_url: width: 2000 }});"></div>
        {% endif %}

        <div class="overlay" style="background-color: {{ block.settings.overlay_color }}; opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }};"></div>

        <div class="slide-content" style="font-family: {{ block.settings.heading_font }};">
          {% if block.settings.heading != blank %}
            <h2 class="slide-heading">{{ block.settings.heading }}</h2>
          {% endif %}

          {% if block.settings.subheading != blank %}
            <p class="slide-subheading" style="font-family: {{ block.settings.subheading_font }};">{{ block.settings.subheading }}</p>
          {% endif %}

          <div class="slide-buttons">
            {% for i in (1..3) %}
              {% assign label_key = 'button_label_' | append: i %}
              {% assign link_key = 'button_link_' | append: i %}
              {% assign label = block.settings[label_key] %}
              {% assign link = block.settings[link_key] %}
              {% if label != blank %}
                <a href="{{ link }}" class="btn">{{ label }}</a>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</section>

<script>
(function() {
  const slider = document.getElementById('CustomSlider-{{ section.id }}');
  let slides = slider.querySelectorAll('.custom-slide');
  let current = 0;

  function showSlide(index) {
    slides.forEach((s, i) => s.style.display = i === index ? 'block' : 'none');
    const duration = parseInt(slides[index].dataset.duration) * 1000 || 5000;
    clearTimeout(window._slideTimer);
    window._slideTimer = setTimeout(() => nextSlide(), duration);
  }

  function nextSlide() {
    current = (current + 1) % slides.length;
    showSlide(current);
  }

  function prevSlide() {
    current = (current - 1 + slides.length) % slides.length;
    showSlide(current);
  }

  slider.addEventListener('keydown', e => {
    if (e.key === 'ArrowRight') nextSlide();
    if (e.key === 'ArrowLeft') prevSlide();
  });

  showSlide(0);
})();
</script>

<style>
.custom-slideshow {
  position: relative;
  overflow: hidden;
}
.custom-slide {
  position: relative;
  width: 100%;
  height: 100vh;
  display: none;
  transition: opacity 1s ease;
}
.slide-media {
  position: absolute;
  width: 100%;
  height: 100%;
  background-size: cover;
  background-position: center;
  z-index: 1;
}
.overlay {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 2;
}
.slide-content {
  position: relative;
  z-index: 3;
  padding: 40px;
  color: white;
}
.slide-buttons .btn {
  margin-right: 10px;
  background: #000;
  color: #fff;
  padding: 10px 20px;
  text-decoration: none;
  display: inline-block;
  border-radius: 4px;
}
.animate--fade { animation: fadeIn 1s ease; }
.animate--slide-in { animation: slideIn 1s ease; }
.animate--zoom { animation: zoomIn 1s ease; }
@keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
@keyframes slideIn { from {transform: translateX(100%);} to {transform: translateX(0);} }
@keyframes zoomIn { from {transform: scale(0.8);} to {transform: scale(1);} }
</style>

{% schema %}
{
  "name": "Custom Advanced Slideshow",
  "settings": [],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Slide Image" },
        { "type": "url", "id": "video_url", "label": "Background Video URL" },
        { "type": "text", "id": "heading", "label": "Heading" },
        { "type": "text", "id": "subheading", "label": "Subheading" },
        {
          "type": "select",
          "id": "slide_animation",
          "label": "Slide Animation",
          "options": [
            { "value": "fade", "label": "Fade" },
            { "value": "slide-in", "label": "Slide In" },
            { "value": "zoom", "label": "Zoom" }
          ],
          "default": "fade"
        },
        { "type": "range", "id": "slide_duration", "label": "Slide Duration (seconds)", "min": 3, "max": 10, "step": 1, "default": 5 },
        { "type": "color", "id": "overlay_color", "label": "Overlay Color", "default": "#000000" },
        { "type": "range", "id": "overlay_opacity", "label": "Overlay Opacity (%)", "min": 0, "max": 100, "step": 10, "default": 50 },
        { "type": "text", "id": "button_label_1", "label": "Button 1 Label" },
        { "type": "url", "id": "button_link_1", "label": "Button 1 Link" },
        { "type": "text", "id": "button_label_2", "label": "Button 2 Label" },
        { "type": "url", "id": "button_link_2", "label": "Button 2 Link" },
        { "type": "text", "id": "button_label_3", "label": "Button 3 Label" },
        { "type": "url", "id": "button_link_3", "label": "Button 3 Link" },
        { "type": "text", "id": "heading_font", "label": "Heading Font", "default": "inherit" },
        { "type": "text", "id": "subheading_font", "label": "Subheading Font", "default": "inherit" }
      ]
    }
  ],
  "presets": [
    { "name": "Custom Advanced Slideshow", "blocks": [ { "type": "slide" }, { "type": "slide" } ] }
  ]
}
{% endschema %}
